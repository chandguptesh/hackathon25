# Import the base image
FROM registry.access.redhat.com/ubi8/nodejs-18:latest

# Set working directory
WORKDIR /project

# Copy package files first (to cache dependencies in layers)
COPY --chown=1001:1001 package.json package-lock.json ./

# Set OpenShift-friendly permissions
RUN chown -R 1001:1001 /project
USER 1001

# Install dependencies (non-interactive, cached)
RUN npm install --no-progress --no-audit

# Copy application files
COPY --chown=1001:1001 . .

# Set environment variables
ENV NODE_ENV=production
ENV PORT=8080
EXPOSE 8080

# Start the application
CMD ["npm", "start"]
